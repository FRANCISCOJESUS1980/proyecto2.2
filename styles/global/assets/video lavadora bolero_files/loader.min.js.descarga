(()=>{var Ce=Object.defineProperty,Re=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var Te=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Z=(t,e,r)=>e in t?Ce(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,f=(t,e)=>{for(var r in e||(e={}))Te.call(e,r)&&Z(t,r,e[r]);if(G)for(var r of G(e))je.call(e,r)&&Z(t,r,e[r]);return t},X=(t,e)=>Re(t,Pe(e));var c=(t,e,r)=>new Promise((o,n)=>{var i=a=>{try{l(r.next(a))}catch(g){n(g)}},s=a=>{try{l(r.throw(a))}catch(g){n(g)}},l=a=>a.done?o(a.value):Promise.resolve(a.value).then(i,s);l((r=r.apply(t,e)).next())});var $=class{constructor(e={}){e=Object.assign({resolveTimeout:null,resolveValue:!0,rejectTimeout:null,rejectValue:!1},e),this._promise=new Promise((s,l)=>{this.resolve=s,this.reject=l}),this.then=this._promise.then.bind(this._promise),this.catch=this._promise.catch.bind(this._promise),this.finally=this._promise.finally.bind(this._promise),this[Symbol.toStringTag]="Promise";let{resolveTimeout:r,resolveValue:o,rejectTimeout:n,rejectValue:i}=e;r&&setTimeout(()=>this.resolve(o),r),n&&setTimeout(()=>this.reject(i),n)}};var C="layer",R="chat",P="quiz";function W(t){return t.reduce(function(e,r){return e[r]=new $,e},{})}function ee(t){return function(e,r){return c(this,null,function*(){if(!t[e])throw new Error(`unknown "${e}" app!`);r(yield t[e])})}}var T="__DF_DEBUG_MODE__",te="true",y=window.sessionStorage;function re(){y.setItem(T,te)}function oe(){y.removeItem(T)}function j(){return y.getItem(T)===te}function b(t){return y.getItem(t)||window[t]}function v(t,e){y.setItem(t,e)}function m(...t){j()&&console.log("[doofinder]",...t)}var Ae=10,ke=500;function ne(t,e={}){let r=document.querySelector(t);return r?Promise.resolve(r):new Promise((o,n)=>{let i=0,s=null,l=e.interval||ke,a=e.times||Ae;s=setInterval(function(){i++<a?(r=document.querySelector(t),r&&(clearInterval(s),o(r))):(clearInterval(s),n(`selector '${t}' not found`))},l)})}var ie=3,se="df:trigger:click",Ne="df:trigger:focus",He="df:trigger:input",ae="df:trigger:submit",A=class{constructor(e){this._minCaptureLength=ie,this._elementSelector=e,this.__chooseTriggerElement__(e),this._eventBus=null,this._eventsQueue=[],this._events=[["click",this.handleClick.bind(this),!0],["focus",this.handleFocus.bind(this),!0],["input",this.handleInput.bind(this),!1],["submit",this.handleSubmit.bind(this),!0],["keypress",this.handleKeypress.bind(this),!0],["keyup",this.handleKeypress.bind(this),!0],["keydown",this.handleKeypress.bind(this),!0]],this._handleSubmit=!1,this._enabled=!1,this._redirection=null}__chooseTriggerElement__(e){this._element=Array.from(document.querySelectorAll(e)).find(r=>r.offsetWidth>0&&r.offsetHeight>0)}updateQuery(e=""){return c(this,null,function*(){let r=yield this.getElement();r instanceof HTMLInputElement&&(r.value=e)})}setCaptureLength(e){this._minCaptureLength=e||ie}getElement(){return c(this,null,function*(){if(!(!this._enabled||!this._elementSelector)){if(!this._element)try{this._element=yield ne(this._elementSelector)}catch(e){this._element=void 0}return this._element}})}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==!!e){this._enabled=!!e;let r=document[`${this._enabled?"add":"remove"}EventListener`];this._events.forEach(o=>r(...o))}}get captureSubmit(){return this._handleSubmit}set captureSubmit(e){this._handleSubmit=!!e}get redirection(){if(this._redirection)return f({},this._redirection)}set redirection(e){this._redirection=e}setEventBus(e){this._eventBus=e}flushMessages(){var e;if(this._eventsQueue=[...new Map(this._eventsQueue).entries()],this._eventsQueue.length>0){let r=this._eventsQueue.shift();for(;r&&r.length===2;)m("trigger:emit",r),(e=this._eventBus)==null||e.emit(...r),r=this._eventsQueue.shift()}else document.activeElement===this._element&&this.notify(se,this.getPayload())}destroy(){this._events.forEach(e=>window.removeEventListener(...e))}shouldHandle(e){let r=this.getElementFromEvent(e);return r?(this._element=r,!0):!1}getPayload(e){let r={source:this._element,originalEvent:e};if(this._element instanceof HTMLInputElement){let o=this._element.value.trim();o.length>=this._minCaptureLength&&(r.query=o)}return r}getElementFromEvent(e){if(!e.target||e.target===document||e.target===window)return;let r=e.type==="submit"?"querySelector":"closest",o=e.target[r](this._elementSelector);if(o&&!o.closest("[dfd-hook]"))return o}handleClick(e){this.shouldHandle(e)&&(e.preventDefault(),e.stopImmediatePropagation(),this.notify(se,this.getPayload(e)))}handleFocus(e){this.shouldHandle(e)&&(e.stopImmediatePropagation(),this.notify(Ne,this.getPayload(e)))}handleInput(e){this.shouldHandle(e)&&this.notify(He,this.getPayload(e))}handleSubmit(e){this._handleSubmit&&this.shouldHandle(e)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this.notify(ae,this.getPayload(e)))}handleKeypress(e){e.key==="Enter"&&this.shouldHandle(e)&&(!!this._redirection||this._handleSubmit)&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),this._redirection?window.location=this._redirection.url:e.type==="keydown"&&this.notify(ae,this.getPayload(e)))}notify(e,r){this._eventBus?this._eventBus.emit(e,r):this._eventsQueue.push([e,r]),m("[trigger]",this._eventBus?"[emit]":"[queue]",e,r)}};var k=class{constructor(e,r){this._bucket=e,this._store=r||window.localStorage}get data(){return JSON.parse(this._store.getItem(this._bucket))||{}}set data(e){this._store.setItem(this._bucket,JSON.stringify(e))}getItem(e){return this.data[e]}setItem(e,r){let o=this.data;o[e]=r,this.data=o}removeItem(e){let r=this.data;delete r[e],this.data=r}clear(){this.data={}}destroy(){this._store.removeItem(this._bucket)}popItem(e){let r=this.data,o=r[e];return delete r[e],this.data=r,o}};function N(t){let e=document.cookie.match(new RegExp("(?:^|; )"+t.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));if(e)return decodeURIComponent(e[1])}var H=Object.freeze({language(t){let[e,r]=(t==null?void 0:t.replace("_","-").trim().split("-"))||[];return e&&r?`${e.toLowerCase()}-${r.toUpperCase()}`:e==null?void 0:e.toLowerCase()},currency(t){return t==null?void 0:t.trim().toUpperCase()}});function ce(){return b("__DF_CDN_PREFIX__")}function p(t,e=!1){let r=b("__DF_LAYER_SERVER__")||`https://${t.toLowerCase()}-layer.doofinder.com`;return e?r.replace(/^http/,"ws"):r}var w=1;function le(){var e;let t=[];return u(t,"source_url",encodeURIComponent(window.location.href)),u(t,"session_id",Doofinder.Session.getSessionId()),u(t,"user_id",Doofinder.Session.getUserId()),u(t,"session_alive",Doofinder.Session.isLive("chat","layer","quiz")),u(t,"last_used_apps",Doofinder.Session.getLastUsedApps()),u(t,"ga_client_id",(e=N("_ga"))==null?void 0:e.substring(6)),u(t,"vsn","1.4.201"),t}function u(t,e,r){r!=null&&(typeof r!="string"||!!r.trim())&&t.push(`${e}=${r}`)}function Oe(t,e){var g;let{installationId:r,zone:o,language:n,currency:i}=t,l=`${p(o)}/api/${w}/installation/${r}`,a=[];return u(a,"source_url",encodeURIComponent(window.location.href)),u(a,"session_id",Doofinder.Session.getSessionId()),u(a,"session_alive",Doofinder.Session.isLive("layer","quiz","chat")),u(a,"last_used_apps",Doofinder.Session.getLastUsedApps()),u(a,"user_id",Doofinder.Session.getUserId()),u(a,"language",H.language(n||document.documentElement.getAttribute("lang"))||""),u(a,"currency",H.currency(i)||""),u(a,"ga_client_id",(g=N("_ga"))==null?void 0:g.substring(6)),u(a,"vsn","1.4.201"),u(a,"layer_type",e),`${l}?${a.join("&")}`}function O(t){let e=ce()||t.cdn_prefix,r=t.vsn,o=n=>`${e}${n}?vsn=${r}`;return j()&&(t.js=t.js.map(n=>n.replace(/\.min\.js/i,".js"))),t.css=t.css.map(o),t.js=t.js.map(o),t}function ue(t,e){return new Promise(function(r,o){fetch(Oe(t,e),{redirect:"follow"}).then(function(n){n.ok?n.json().then(function(i){r(O(i))}):o(`HTTP ${n.status} error response from server`)}).catch(n=>o(n))})}function de(t){return c(this,null,function*(){let{chat_id:e,zone:r}=t,o=`${p(r)}/chat/${e}`,n=le(),s=yield(yield fetch(`${o}?${n.join("&")}`,{redirect:"follow"})).json();return O(s)})}function me(t){return c(this,null,function*(){let{quiz_id:e,zone:r}=t,o=`${p(r)}/quiz/${e}`,n=le(),s=yield(yield fetch(`${o}?${n.join("&")}`,{redirect:"follow"})).json();return O(s)})}function E(t){return c(this,null,function*(){if(!document.querySelector(`script[src="${t}"]`)){let e=document.createElement("script");e.src=t,e.async=1,document.head.appendChild(e)}})}function x(t){return c(this,null,function*(){if(!document.querySelector(`link[rel="stylesheet"][href="${t}"]`)){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),document.head.appendChild(e)}})}function _(t){return c(this,null,function*(){let e=document.createElement("style");e.appendChild(document.createTextNode((t||"").trim())),document.head.appendChild(e)})}function he(t,e){let r=e.options,o=t.hashid||r.hashid,{autoload:n,insertion_point:i}=e,s="urlHash"in t?!!t.urlHash:!!r.url_hash,l=e.layer_type;return delete t.urlHash,delete r.url_hash,X(f(f({},t),r),{autoload:n,urlHash:s,hashid:o,layerType:l,insertion_point:i})}function fe(t){return v("__DF_CDN_PREFIX__",t)}function pe(t){return v("__DF_LAYER_SERVER__",t)}function S(){try{decodeURIComponent(location.href)}catch(t){throw new Error("invalid UTF-8 on url-encoded query params")}}function _e(t=8){let e="";for(;e.length<t;)e=`${e}${Math.random().toString(36).substring(2)}`;return e.substr(0,t)}var ge=function(t){let e=t.slice(0,4);return RegExp(`#${e}/(category-pages|mobile-category-pages)/`)};"use strict";var Ve=window.history,V=class{constructor({installationId:e,urlHash:r}){this._installationId=e,this._urlHash=r,this._dataStore=new k(`${this._installationId}.category_merchandising.state`,window.sessionStorage)}get(){return this.__fromBackState__()||this.__fromHash__()}save(e){this.update(e)}replace(e){this.update(e)}update(e){if(!this.__isStateValid__(e))return;m("[category pages state] update state ",e),this._dataStore.setItem("currentState",e);let r=this.absoluteURL(e);Ve.replaceState(r,"",this._urlHash?r:"")}saveCurrentAsBackState(){this._dataStore.setItem("backState",this.__currentState__())}__fromBackState__(){if(!this.__loadBackState__())return null;let e=this.__popBackState__();return m("[category pages state] __fromBackState__ state",e),e}__fromHash__(){let e=window.location.hash;return this.__isStateValid__(e)?(e=e.split("#",2)[1],m("[category pages state] __fromHash__ ",e),e):null}__currentState__(){return this._dataStore.getItem("currentState")}__loadBackState__(){return this._dataStore.getItem("backState")||!1}__popBackState__(){let e=this._dataStore.getItem("backState");return this._dataStore.removeItem("backState"),m("[category pages state] __popBackState__ ",e),e}absoluteURL(e){return window.location.origin+window.location.pathname+e}__isStateValid__(e){return typeof e=="string"&&ge(this._installationId).test(e)}};function ye(t){return c(this,null,function*(){var i;t.session_id=Doofinder.Session.getSessionId(),t.user_id=Doofinder.Session.getUserId();let{installationId:e,urlHash:r}=t;state=new V({installationId:e,urlHash:r}).get(),state&&(t.state=state),m("[category pages] displayForSeo options: ",t);let o=yield Fe(t);if(m("[category pages] displayForSeo htmlContent: ",o),!o)return;mount=Be(o),t.device=="mobile"&&(mount.classList.remove("dfd-embedded"),mount.classList.add("dfd-mobile_embedded")),t.custom_css.forEach(_);let n=(i=t.custom_properties)==null?void 0:i.join(`
`);_(`#${mount.id} {
${n||""}
}`),element=document.querySelector(t.insertion_point),element&&element.appendChild(mount)})}function Be(t){let e=document.createElement("div");return e.id=`df-${_e(32)}`,e.dataset.dfdView="Search",e.classList.add("dfd-root"),e.classList.add("dfd-embedded"),e.setAttribute("data-dfd-screen","category-pages"),e.insertAdjacentHTML("afterbegin",t),e}function Fe(t){return c(this,null,function*(){let{zone:e}=t,r=p(e),o=new URL(`${r}/api/${w}/categorypage`);return Object.keys(t).forEach(function(n){let i=t[n];typeof i=="object"&&(i=JSON.stringify(i)),o.searchParams.append(n,i)}),htmlContent=yield fetch(o).then(function(n){return n.ok?n.text():""}),htmlContent})}var I,Me=new Uint8Array(16);function B(){if(!I&&(I=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!I))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return I(Me)}var d=[];for(let t=0;t<256;++t)d.push((t+256).toString(16).slice(1));function Se(t,e=0){return d[t[e+0]]+d[t[e+1]]+d[t[e+2]]+d[t[e+3]]+"-"+d[t[e+4]]+d[t[e+5]]+"-"+d[t[e+6]]+d[t[e+7]]+"-"+d[t[e+8]]+d[t[e+9]]+"-"+d[t[e+10]]+d[t[e+11]]+d[t[e+12]]+d[t[e+13]]+d[t[e+14]]+d[t[e+15]]}var ze=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:ze};function qe(t,e,r){if(F.randomUUID&&!e&&!t)return F.randomUUID();t=t||{};let o=t.random||(t.rng||B)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,e){r=r||0;for(let n=0;n<16;++n)e[r+n]=o[n];return e}return Se(o)}var D=qe;var be={canPushState(){return typeof history.pushState!="undefined"},dropLocal(t,e,r){return t.removeItem(this.localKey(e,r))},updateLocal(t,e,r,o,n){let i=this.getLocal(t,e,r),s=this.localKey(e,r),l=i===null?o:n(i);return t.setItem(s,JSON.stringify(l)),l},getLocal(t,e,r){return JSON.parse(t.getItem(this.localKey(e,r)))},updateCurrentState(t){!this.canPushState()||history.replaceState(t(history.state||{}),"",window.location.href)},pushState(t,e,r){if(this.canPushState()){if(r!==window.location.href){if(e.type=="redirect"&&e.scroll){let n=history.state||{};n.scroll=e.scroll,history.replaceState(n,"",window.location.href)}delete e.scroll,history[t+"State"](e,"",r||null);let o=this.getHashTargetEl(window.location.hash);o?o.scrollIntoView():e.type==="redirect"&&window.scroll(0,0)}}else this.redirect(r)},setCookie(t,e){document.cookie=`${t}=${e}`},getCookie(t){return document.cookie.replace(new RegExp(`(?:(?:^|.*;s*)${t}s*=s*([^;]*).*$)|^.*$`),"$1")},redirect(t,e){e&&be.setCookie("__phoenix_flash__",e+"; max-age=60000; path=/"),window.location=t},localKey(t,e){return`${t}-${e}`},getHashTargetEl(t){let e=t.toString().substring(1);if(e!=="")return document.getElementById(e)||document.querySelector(`a[name="${e}"]`)}},M=be;var ve=12*60*60*1e3,we="df",Ee="random-userid",z="session",xe="apps",Ie=window.localStorage;function q(t){return M.getLocal(Ie,we,t)}function L(t,e){return M.updateLocal(Ie,we,t,e,()=>e)}function Ke(){return{id:D().replaceAll("-",""),expiry:new Date().getTime()+ve,live:[]}}function K(){let t=q(z);return(!t||Ye(t))&&(t=Ke()),L(z,t)}function Ye({expiry:t}){return t<new Date().getTime()}var h={getUserId(){return q(Ee)||L(Ee,D())},getSessionId(){return m("[session][getSessionId()] called!"),K().id},setLive(t){m("[session][setLive()] called!",t);let e=K();e.live.includes(t)||e.live.push(t),e.expiry=new Date().getTime()+ve,L(z,e),L(xe,e.live.join())},getLastUsedApps(){return q(xe)||""},isLive(...t){let e=K();return t.some(o=>e.live.includes(o))}};function Qe(){return{"content-type":"application/json"}}function U(r){return c(this,arguments,function*(t,e={}){return(yield fetch(t,f({method:"GET",cache:"no-cache",mode:"cors",headers:Qe()},e))).json()})}var Y=class{constructor(e){this.zone=e}add(l,a,g){return c(this,arguments,function*(e,r,{id:o,title:n,price:i},s=1){let Ue=`${this.url(e)}/cart/${h.getSessionId()}`,$e=JSON.stringify({amount:s,id:o,title:n,price:i,index:r});return U(Ue,{method:"PUT",body:$e})})}remove(e,r,o,n=1){return c(this,null,function*(){let i=`${this.url(e)}/cart/${h.getSessionId()}`,s=JSON.stringify({amount:n,id:o,index:r});return U(i,{method:"PATCH",body:s})})}clear(e){return c(this,null,function*(){let r=`${this.url(e)}/cart/${h.getSessionId()}`;return U(r,{method:"DELETE"})})}checkout(e){return c(this,null,function*(){let r=JSON.stringify({session_id:h.getSessionId(),user_id:h.getUserId(),sources:h.getLastUsedApps().split(",")});return U(`${this.url(e)}/checkout`,{method:"PUT",body:r})})}url(e){return`https://${this.zone}-search.doofinder.com/6/${e}/stats`}};var Je={get Session(){return h},buildCart(t){return new Y(t)}},De=Je;var Q=W([C,R,P]),J=ee(Q);document.addEventListener("doofinder.register",t=>{let{name:e,entrypoint:r}=t.detail;Q[e].resolve(r)});var Ge={vsn:"1.4.201",getRegistry(t){return Q[t]},load(t,e){S(),Le(t,e,"search")},loadCategoryPages(t,e){S(),ye(t),Le(t,e,"category_pages")},loadChat(t,e){S(),de(t).then(r=>{r.css.forEach(x),J(R,function(o){let n=o.create(t);typeof e=="function"&&e(n)}),r.js.forEach(E)})},loadQuiz(t,e){S(),me(t).then(r=>{r.css.forEach(x),_(r.custom_css),J(P,function(o){let n=o.create(t);typeof e=="function"&&e(n)}),r.js.forEach(E)})},enableDebug:re,disableDebug:oe,setLayerServerUrl:pe,setCDNServerUrl:fe};function Le(t,e,r){ue(t,r).then(o=>{var i;o.css.forEach(x),o.custom_css.forEach(_);let n=(i=o.custom_properties)==null?void 0:i.join(`
`);t=he(t,o),t.trigger=Ze(t),J(C,function(s){let l=s.create(t);_(`#${l.mount.id} {
${n||""}
}`),r=="category_pages"&&l.open(t),typeof e=="function"&&e(l)}),o.js.forEach(E)}).catch(o=>{console.error("[Doofinder] error retrieving resources:",o)})}function Ze(t){let{autoload:e,trigger:r}=t,o=new A(r);return o.enabled=!e||e.trigger,o}Object.defineProperty(window,"Doofinder",{value:De,writable:!1});Object.defineProperty(window,"doofinderLoader",{value:Ge,writable:!1});})();
